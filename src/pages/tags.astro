---
import Base from '@/layouts/Base.astro';
import { fetchTags, fetchMeta } from '@/lib/api';
import { slugify } from '@/lib/utils';

const [tags, meta] = await Promise.all([fetchTags(), fetchMeta()]);
const updatedAt = meta.generated_at;
---

<Base title="All Tags - News Site" description="Browse all news categories and topics">
  <meta slot="head" name="lastmod" content={updatedAt} />
  <script slot="head" type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "All Categories",
    "description": "Browse all news categories and topics",
    "dateModified": updatedAt,
    "url": `${new URL(import.meta.env.SITE || "https://newshelp.org").origin}/tags`
  })} />

  <div class="page-content">
    <section class="tags-page">
      <h1>All Categories</h1>
      <p class="tags-page__subtitle">Browse news by topic</p>
      <time class="last-updated" datetime={updatedAt}>
        Last updated: {new Date(updatedAt).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
        })}
      </time>

      <div class="tags-grid">
        {tags.map((tag) => (
          <a href={`/tag/${slugify(tag.tag)}`} class="tag-card">
            <h2>{tag.tag}</h2>
          </a>
        ))}
      </div>
    </section>
  </div>
</Base>

<style>
  .page-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .tags-page {
    text-align: center;
    margin-bottom: 3rem;
  }

  .tags-page h1 {
    font-size: 3rem;
    margin-bottom: 0.5rem;
    color: var(--color-primary);
  }

  .tags-page__subtitle {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
  }

  .last-updated {
    display: inline-block;
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    background: var(--color-surface);
    border-radius: 20px;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .tags-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
  }

  .tag-card {
    padding: 1.5rem;
    background: var(--color-surface);
    border: 2px solid var(--color-accent);
    border-radius: 12px;
    text-decoration: none;
    color: var(--color-text);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .tag-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--color-primary);
  }

  .tag-card h2 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--color-primary);
  }
</style>
